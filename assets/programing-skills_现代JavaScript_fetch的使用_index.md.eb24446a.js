import{_ as s,o as n,c as a,b as l}from"./app.79da0fb4.js";const o="/assets/image-20210802212235759.08c40732.png",p="/assets/QQ\u622A\u56FE20210802212735.42e72062.png",e="/assets/image-20210803095100585.48293470.png",t="/assets/image-20210803104337360.31d13ed6.png",g=JSON.parse('{"title":"fetch\u7684\u4F7F\u7528","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u57FA\u672C\u7528\u6CD5","slug":"\u57FA\u672C\u7528\u6CD5","link":"#\u57FA\u672C\u7528\u6CD5","children":[{"level":3,"title":"POST\u8BF7\u6C42","slug":"post\u8BF7\u6C42","link":"#post\u8BF7\u6C42","children":[]}]},{"level":2,"title":"FormData","slug":"formdata","link":"#formdata","children":[{"level":3,"title":"\u65B9\u6CD5","slug":"\u65B9\u6CD5","link":"#\u65B9\u6CD5","children":[]},{"level":3,"title":"\u53D1\u9001\u6709\u56FE\u7247\u7684\u8868\u5355","slug":"\u53D1\u9001\u6709\u56FE\u7247\u7684\u8868\u5355","link":"#\u53D1\u9001\u6709\u56FE\u7247\u7684\u8868\u5355","children":[]},{"level":3,"title":"\u53D1\u9001\u5177\u6709 Blob \u6570\u636E\u7684\u8868\u5355","slug":"\u53D1\u9001\u5177\u6709-blob-\u6570\u636E\u7684\u8868\u5355","link":"#\u53D1\u9001\u5177\u6709-blob-\u6570\u636E\u7684\u8868\u5355","children":[]}]},{"level":2,"title":"\u8DDF\u8E2A\u4E0B\u8F7D\u8FDB\u5EA6","slug":"\u8DDF\u8E2A\u4E0B\u8F7D\u8FDB\u5EA6","link":"#\u8DDF\u8E2A\u4E0B\u8F7D\u8FDB\u5EA6","children":[]},{"level":2,"title":"\u4E2D\u6B62\uFF08Abort\uFF09","slug":"\u4E2D\u6B62-abort","link":"#\u4E2D\u6B62-abort","children":[]},{"level":2,"title":"\u8DE8\u6E90\u8BF7\u6C42","slug":"\u8DE8\u6E90\u8BF7\u6C42","link":"#\u8DE8\u6E90\u8BF7\u6C42","children":[{"level":3,"title":"\u7B80\u5355\u7684\u8BF7\u6C42","slug":"\u7B80\u5355\u7684\u8BF7\u6C42","link":"#\u7B80\u5355\u7684\u8BF7\u6C42","children":[]},{"level":3,"title":"\\"\u975E\u7B80\u5355\\"\u8BF7\u6C42","slug":"\u975E\u7B80\u5355-\u8BF7\u6C42","link":"#\u975E\u7B80\u5355-\u8BF7\u6C42","children":[]},{"level":3,"title":"\u51ED\u636E","slug":"\u51ED\u636E","link":"#\u51ED\u636E","children":[]}]},{"level":2,"title":"fetch API","slug":"fetch-api","link":"#fetch-api","children":[]},{"level":2,"title":"URL\u5BF9\u8C61","slug":"url\u5BF9\u8C61","link":"#url\u5BF9\u8C61","children":[]},{"level":2,"title":"XMLHttpRequest","slug":"xmlhttprequest","link":"#xmlhttprequest","children":[{"level":3,"title":"\u57FA\u672C\u4F7F\u7528","slug":"\u57FA\u672C\u4F7F\u7528","link":"#\u57FA\u672C\u4F7F\u7528","children":[]},{"level":3,"title":"POST\u8BF7\u6C42","slug":"post\u8BF7\u6C42-1","link":"#post\u8BF7\u6C42-1","children":[]},{"level":3,"title":"\u4E0A\u4F20\u8FDB\u5EA6","slug":"\u4E0A\u4F20\u8FDB\u5EA6","link":"#\u4E0A\u4F20\u8FDB\u5EA6","children":[]},{"level":3,"title":"\u8DE8\u6E90\u8BF7\u6C42","slug":"\u8DE8\u6E90\u8BF7\u6C42-1","link":"#\u8DE8\u6E90\u8BF7\u6C42-1","children":[]}]},{"level":2,"title":"\u957F\u8F6E\u8BE2","slug":"\u957F\u8F6E\u8BE2","link":"#\u957F\u8F6E\u8BE2","children":[]}],"relativePath":"programing-skills/\u73B0\u4EE3JavaScript/fetch\u7684\u4F7F\u7528/index.md"}'),c={name:"programing-skills/\u73B0\u4EE3JavaScript/fetch\u7684\u4F7F\u7528/index.md"},r=l(`<h1 id="fetch\u7684\u4F7F\u7528" tabindex="-1">fetch\u7684\u4F7F\u7528 <a class="header-anchor" href="#fetch\u7684\u4F7F\u7528" aria-hidden="true">#</a></h1><h2 id="\u57FA\u672C\u7528\u6CD5" tabindex="-1">\u57FA\u672C\u7528\u6CD5 <a class="header-anchor" href="#\u57FA\u672C\u7528\u6CD5" aria-hidden="true">#</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> promise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [options])</span></span>
<span class="line"></span></code></pre></div><ul><li><code>url</code> \u2014\u2014 \u8981\u8BBF\u95EE\u7684 URL\u3002</li><li><code>options</code> \u2014\u2014 \u53EF\u9009\u53C2\u6570\uFF1Amethod\uFF0Cheader \u7B49\u3002</li></ul><p>\u6CA1\u6709 <code>options</code>\uFF0C\u90A3\u5C31\u662F\u4E00\u4E2A\u7B80\u5355\u7684 GET \u8BF7\u6C42\uFF0C\u4E0B\u8F7D <code>url</code> \u7684\u5185\u5BB9\u3002\u6D4F\u89C8\u5668\u7ACB\u5373\u542F\u52A8\u8BF7\u6C42\uFF0C\u5E76\u8FD4\u56DE\u4E00\u4E2A\u8BE5\u8C03\u7528\u4EE3\u7801\u5E94\u8BE5\u7528\u6765\u83B7\u53D6\u7ED3\u679C\u7684 <code>promise</code>\u3002</p><p>\u83B7\u53D6\u54CD\u5E94\u901A\u5E38\u9700\u8981\u7ECF\u8FC7\u4E24\u4E2A\u9636\u6BB5\uFF1A</p><p>\u7B2C\u4E00\u9636\u6BB5\uFF0C\u5F53\u670D\u52A1\u5668\u53D1\u9001\u4E86\u54CD\u5E94\u5934\uFF08response header\uFF09\uFF0C<code>fetch</code> \u8FD4\u56DE\u7684 <code>promise</code> \u5C31\u4F7F\u7528\u5185\u5EFA\u7684 Response class \u5BF9\u8C61\u6765\u5BF9\u54CD\u5E94\u5934\u8FDB\u884C\u89E3\u6790\u3002</p><p>\u901A\u8FC7\u68C0\u67E5\u54CD\u5E94\u5934\uFF0C\u6765\u68C0\u67E5 HTTP \u72B6\u6001\u4EE5\u786E\u5B9A\u8BF7\u6C42\u662F\u5426\u6210\u529F\uFF0C\u5F53\u524D\u8FD8\u6CA1\u6709\u54CD\u5E94\u4F53\uFF08response body\uFF09\u3002\u5982\u679C <code>fetch</code> \u65E0\u6CD5\u5EFA\u7ACB\u4E00\u4E2A HTTP \u8BF7\u6C42\uFF0C\u4F8B\u5982\u7F51\u7EDC\u95EE\u9898\uFF0C\u4EA6\u6216\u662F\u8BF7\u6C42\u7684\u7F51\u5740\u4E0D\u5B58\u5728\uFF0C\u90A3\u4E48 promise \u5C31\u4F1A reject\u3002</p><p>\u54CD\u5E94\u7684\u5C5E\u6027\uFF1A</p><ul><li><code>response.status</code> \u2014\u2014 response \u7684 HTTP \u72B6\u6001\u7801\uFF0C</li><li><code>response.ok</code> \u2014\u2014 HTTP \u72B6\u6001\u7801\u4E3A 200-299\uFF0C\u5219\u4E3A <code>true</code>\u3002</li><li><code>response.headers</code> \u2014\u2014 \u7C7B\u4F3C\u4E8E Map \u7684\u5E26\u6709 HTTP header \u7684\u5BF9\u8C61\u3002</li></ul><p>\u7B2C\u4E8C\u9636\u6BB5\uFF0C\u4E3A\u4E86\u83B7\u53D6 response body\uFF0C\u6211\u4EEC\u9700\u8981\u4F7F\u7528\u4E00\u4E2A\u5176\u4ED6\u7684\u65B9\u6CD5\u8C03\u7528\u3002</p><p><code>Response</code> \u63D0\u4F9B\u4E86\u591A\u79CD\u57FA\u4E8E promise \u7684\u65B9\u6CD5\uFF0C\u6765\u4EE5\u4E0D\u540C\u7684\u683C\u5F0F\u8BBF\u95EE body\uFF1A</p><ul><li><code>response.text()</code>\u2014\u2014 \u8BFB\u53D6 response\uFF0C\u5E76\u4EE5\u6587\u672C\u5F62\u5F0F\u8FD4\u56DE response\uFF0C</li><li><code>response.json()</code> \u2014\u2014 \u5C06 response \u89E3\u6790\u4E3A JSON</li><li><code>response.formData()</code>\u2014\u2014 \u4EE5 <code>FormData</code> \u5BF9\u8C61\u7684\u5F62\u5F0F\u8FD4\u56DE response\uFF0C</li><li><code>response.blob()</code> \u2014\u2014 \u4EE5 Blob\uFF08\u5177\u6709\u7C7B\u578B\u7684\u4E8C\u8FDB\u5236\u6570\u636E\uFF09\u5F62\u5F0F\u8FD4\u56DE response\uFF0C</li><li><code>response.arrayBuffer()</code>\u2014\u2014 \u4EE5 ArrayBuffer\uFF08\u4F4E\u7EA7\u522B\u7684\u4E8C\u8FDB\u5236\u6570\u636E\uFF09\u5F62\u5F0F\u8FD4\u56DE response\uFF0C</li><li>\u53E6\u5916\uFF0C<code>response.body</code> \u662F ReadableStream \u5BF9\u8C61\uFF0C\u5B83\u5141\u8BB8\u4F60\u9010\u5757\u8BFB\u53D6 body\uFF0C\u6211\u4EEC\u7A0D\u540E\u4F1A\u7528\u4E00\u4E2A\u4F8B\u5B50\u89E3\u91CA\u5B83\u3002</li></ul><p>\u53D1\u9001\u8BF7\u6C42\u7684\u4E24\u79CD\u5199\u6CD5\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://api.github.com/repos/javascript-tutorial/en.javascript.info/commits</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(url)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> commits </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u8BFB\u53D6 response body\uFF0C\u5E76\u5C06\u5176\u89E3\u6790\u4E3A JSON</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(commits[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">author</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">login)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://api.github.com/repos/javascript-tutorial/en.javascript.info/commits</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;">response</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;">commits</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(commits[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">author</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">login))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u54CD\u5E94\u5934\uFF1A<code>response.header</code>\u5BF9\u8C61</p><p>\u8BF7\u6C42\u5934\uFF1Afetch\u4E2D\u4F7F\u7528<code>headers</code>\u9009\u9879</p><h3 id="post\u8BF7\u6C42" tabindex="-1">POST\u8BF7\u6C42 <a class="header-anchor" href="#post\u8BF7\u6C42" aria-hidden="true">#</a></h3><ul><li><code>method</code> \u2014\u2014 HTTP \u65B9\u6CD5\uFF0C\u4F8B\u5982 <code>POST</code>\uFF0C</li><li><code>body</code>\u2014\u2014 request body\uFF0C\u5176\u4E2D\u4E4B\u4E00\uFF1A <ul><li>\u5B57\u7B26\u4E32\uFF08\u4F8B\u5982 JSON \u7F16\u7801\u7684\uFF09</li><li><code>FormData</code> \u5BF9\u8C61\uFF0C\u4EE5 <code>form/multipart</code> \u5F62\u5F0F\u53D1\u9001\u6570\u636E</li><li><code>Blob</code>/<code>BufferSource</code> \u53D1\u9001\u4E8C\u8FDB\u5236\u6570\u636E</li><li>URLSearchParams\uFF0C\u4EE5 <code>x-www-form-urlencoded</code> \u7F16\u7801\u5F62\u5F0F\u53D1\u9001\u6570\u636E\uFF0C\u5F88\u5C11\u4F7F\u7528</li></ul></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> user </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">surname</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Smith</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/article/fetch/post/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json;charset=utf-8</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(user)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5982\u679C\u8BF7\u6C42\u7684 <code>body</code> \u662F\u5B57\u7B26\u4E32\uFF0C\u5219 <code>Content-Type</code> \u4F1A\u9ED8\u8BA4\u8BBE\u7F6E\u4E3A <code>text/plain;charset=UTF-8</code></p></blockquote><h2 id="formdata" tabindex="-1">FormData <a class="header-anchor" href="#formdata" aria-hidden="true">#</a></h2><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">formElem</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">value</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">surname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">value</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Smith</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">submit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  formElem</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onsubmit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">preventDefault</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/article/formdata/post/user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      body</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">FormData</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">formElem</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><h3 id="\u65B9\u6CD5" tabindex="-1">\u65B9\u6CD5 <a class="header-anchor" href="#\u65B9\u6CD5" aria-hidden="true">#</a></h3><ul><li><code>formData.append(name, value)</code> \u2014\u2014 \u6DFB\u52A0\u5177\u6709\u7ED9\u5B9A <code>name</code> \u548C <code>value</code> \u7684\u8868\u5355\u5B57\u6BB5\uFF0C</li><li><code>formData.append(name, blob, fileName)</code> \u2014\u2014 \u6DFB\u52A0\u4E00\u4E2A\u5B57\u6BB5\uFF0C\u5C31\u50CF\u5B83\u662F <code>&lt;input type=&quot;file&quot;&gt;</code>\uFF0C\u7B2C\u4E09\u4E2A\u53C2\u6570 <code>fileName</code> \u8BBE\u7F6E\u6587\u4EF6\u540D\uFF08\u800C\u4E0D\u662F\u8868\u5355\u5B57\u6BB5\u540D\uFF09\uFF0C\u56E0\u4E3A\u5B83\u662F\u7528\u6237\u6587\u4EF6\u7CFB\u7EDF\u4E2D\u6587\u4EF6\u7684\u540D\u79F0\uFF0C</li><li><code>formData.delete(name)</code> \u2014\u2014 \u79FB\u9664\u5E26\u6709\u7ED9\u5B9A <code>name</code> \u7684\u5B57\u6BB5\uFF0C</li><li><code>formData.get(name)</code> \u2014\u2014 \u83B7\u53D6\u5E26\u6709\u7ED9\u5B9A <code>name</code> \u7684\u5B57\u6BB5\u503C\uFF0C</li><li><code>formData.has(name)</code> \u2014\u2014 \u5982\u679C\u5B58\u5728\u5E26\u6709\u7ED9\u5B9A <code>name</code> \u7684\u5B57\u6BB5\uFF0C\u5219\u8FD4\u56DE <code>true</code>\uFF0C\u5426\u5219\u8FD4\u56DE <code>false</code>\u3002</li><li><code>formData.set(name, value)</code>\uFF0C</li><li><code>formData.set(name, blob, fileName)</code>\u3002</li><li>\u53EF\u4EE5\u7528<code>for\u2026of</code>\u5FAA\u73AF\u8FED\u4EE3fromData\u5B57\u6BB5</li></ul><h3 id="\u53D1\u9001\u6709\u56FE\u7247\u7684\u8868\u5355" tabindex="-1">\u53D1\u9001\u6709\u56FE\u7247\u7684\u8868\u5355 <a class="header-anchor" href="#\u53D1\u9001\u6709\u56FE\u7247\u7684\u8868\u5355" aria-hidden="true">#</a></h3><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">formElem</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">firstName</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">value</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  Picture: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">picture</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">accept</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">submit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  formElem</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onsubmit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">preventDefault</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/article/formdata/post/user-avatar</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      body</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">FormData</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">formElem</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><h3 id="\u53D1\u9001\u5177\u6709-blob-\u6570\u636E\u7684\u8868\u5355" tabindex="-1">\u53D1\u9001\u5177\u6709 Blob \u6570\u636E\u7684\u8868\u5355 <a class="header-anchor" href="#\u53D1\u9001\u5177\u6709-blob-\u6570\u636E\u7684\u8868\u5355" aria-hidden="true">#</a></h3><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">style</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">margin:0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">canvas</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">canvasElem</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">80</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">style</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">border:1px solid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">canvas</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">value</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Submit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onclick</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;">submit</span><span style="color:#C3E88D;">()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    canvasElem</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onmousemove</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvasElem</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getContext</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lineTo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">clientX</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">clientY</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stroke</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">submit</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">imageBlob</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">canvasElem</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBlob</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">image/png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">formData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">FormData</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">formData</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">firstName</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">formData</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">imageBlob</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/article/formdata/post/image-form</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        body</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">formData</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><h2 id="\u8DDF\u8E2A\u4E0B\u8F7D\u8FDB\u5EA6" tabindex="-1">\u8DDF\u8E2A\u4E0B\u8F7D\u8FDB\u5EA6 <a class="header-anchor" href="#\u8DDF\u8E2A\u4E0B\u8F7D\u8FDB\u5EA6" aria-hidden="true">#</a></h2><blockquote><p>\u6CE8\u610F\uFF1Afetch\u5230\u76EE\u524D\u4E3A\u6B62\u65B9\u6CD5\u65E0\u6CD5\u8DDF\u8E2A\u4E0A\u4F20\u8FDB\u5EA6</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// Step 1\uFF1A\u542F\u52A8 fetch\uFF0C\u5E76\u83B7\u5F97\u4E00\u4E2A reader</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://api.github.com/repos/javascript-tutorial/en.javascript.info/commits?per_page=100</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> reader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getReader</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Step 2\uFF1A\u83B7\u5F97\u603B\u957F\u5EA6\uFF08length\uFF09</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> contentLength </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Length</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Step 3\uFF1A\u8BFB\u53D6\u6570\u636E</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> receivedLength </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u5F53\u524D\u63A5\u6536\u5230\u4E86\u8FD9\u4E48\u591A\u5B57\u8282</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> chunks </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u63A5\u6536\u5230\u7684\u4E8C\u8FDB\u5236\u5757\u7684\u6570\u7EC4\uFF08\u5305\u62EC body\uFF09</span></span>
<span class="line"><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">done</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reader</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">done</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">chunks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">receivedLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Received </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">receivedLength</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> of </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">contentLength</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Step 4\uFF1A\u5C06\u5757\u8FDE\u63A5\u5230\u5355\u4E2A Uint8Array</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> chunksAll </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Uint8Array</span><span style="color:#A6ACCD;">(receivedLength)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// (4.1)</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> position </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> chunk </span><span style="color:#89DDFF;">of</span><span style="color:#A6ACCD;"> chunks) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">chunksAll</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">position</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// (4.2)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">position</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// Step 5\uFF1A\u89E3\u7801\u6210\u5B57\u7B26\u4E32</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TextDecoder</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">decode</span><span style="color:#A6ACCD;">(chunksAll)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u6211\u4EEC\u5B8C\u6210\u5566\uFF01</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> commits </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(result)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(commits[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">author</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">login)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><code>await reader.read()</code> \u8C03\u7528\u7684\u7ED3\u679C\u662F\u4E00\u4E2A\u5177\u6709\u4E24\u4E2A\u5C5E\u6027\u7684\u5BF9\u8C61\uFF1A</p><ul><li><code>done</code> \u2014\u2014 \u5F53\u8BFB\u53D6\u5B8C\u6210\u65F6\u4E3A <code>true</code>\uFF0C\u5426\u5219\u4E3A <code>false</code></li><li><code>value</code> \u2014\u2014 \u5B57\u8282\u7684\u7C7B\u578B\u5316\u6570\u7EC4\uFF1A<code>Uint8Array</code></li></ul><p>\u8BA9\u6211\u4EEC\u4E00\u6B65\u6B65\u89E3\u91CA\u4E0B\u8FD9\u4E2A\u8FC7\u7A0B\uFF1A</p><ol><li><p>\u6211\u4EEC\u50CF\u5F80\u5E38\u4E00\u6837\u6267\u884C <code>fetch</code>\uFF0C\u4F46\u4E0D\u662F\u8C03\u7528 <code>response.json()</code>\uFF0C\u800C\u662F\u83B7\u5F97\u4E86\u4E00\u4E2A\u6D41\u8BFB\u53D6\u5668\uFF08stream reader\uFF09<code>response.body.getReader()</code>\u3002</p><p>\u8BF7\u6CE8\u610F\uFF0C\u6211\u4EEC\u4E0D\u80FD\u540C\u65F6\u4F7F\u7528\u8FD9\u4E24\u79CD\u65B9\u6CD5\u6765\u8BFB\u53D6\u76F8\u540C\u7684\u54CD\u5E94\u3002\u8981\u4E48\u4F7F\u7528\u6D41\u8BFB\u53D6\u5668\uFF0C\u8981\u4E48\u4F7F\u7528 reponse \u65B9\u6CD5\u6765\u83B7\u53D6\u7ED3\u679C\u3002</p></li><li><p>\u5728\u8BFB\u53D6\u6570\u636E\u4E4B\u524D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4ECE <code>Content-Length</code> header \u4E2D\u5F97\u5230\u5B8C\u6574\u7684\u54CD\u5E94\u957F\u5EA6\u3002</p><p>\u8DE8\u6E90\u8BF7\u6C42\u4E2D\u53EF\u80FD\u4E0D\u5B58\u5728\u8FD9\u4E2A header\uFF08\u8BF7\u53C2\u89C1 <a href="https://zh.javascript.info/fetch-crossorigin" target="_blank" rel="noreferrer">Fetch\uFF1A\u8DE8\u6E90\u8BF7\u6C42</a>\uFF09\uFF0C\u5E76\u4E14\u4ECE\u6280\u672F\u4E0A\u8BB2\uFF0C\u670D\u52A1\u5668\u53EF\u4EE5\u4E0D\u8BBE\u7F6E\u5B83\u3002\u4F46\u662F\u901A\u5E38\u60C5\u51B5\u4E0B\u5B83\u90FD\u4F1A\u5728\u90A3\u91CC\u3002</p></li><li><p>\u8C03\u7528 <code>await reader.read()</code>\uFF0C\u76F4\u5230\u5B83\u5B8C\u6210\u3002</p><p>\u6211\u4EEC\u5C06\u54CD\u5E94\u5757\u6536\u96C6\u5230\u6570\u7EC4 <code>chunks</code> \u4E2D\u3002\u8FD9\u5F88\u91CD\u8981\uFF0C\u56E0\u4E3A\u5728\u4F7F\u7528\u5B8C\uFF08consumed\uFF09\u54CD\u5E94\u540E\uFF0C\u6211\u4EEC\u5C06\u65E0\u6CD5\u4F7F\u7528 <code>response.json()</code> \u6216\u8005\u5176\u4ED6\u65B9\u5F0F\uFF08\u4F60\u53EF\u4EE5\u8BD5\u8BD5\uFF0C\u5C06\u4F1A\u51FA\u73B0 error\uFF09\u53BB\u201C\u91CD\u65B0\u8BFB\u53D6\u201D\u5B83\u3002</p></li><li><p>\u6700\u540E\uFF0C\u6211\u4EEC\u6709\u4E86\u4E00\u4E2A <code>chunks</code> \u2014\u2014 \u4E00\u4E2A <code>Uint8Array</code> \u5B57\u8282\u5757\u6570\u7EC4\u3002\u6211\u4EEC\u9700\u8981\u5C06\u8FD9\u4E9B\u5757\u5408\u5E76\u6210\u4E00\u4E2A\u7ED3\u679C\u3002\u4F46\u4E0D\u5E78\u7684\u662F\uFF0C\u6CA1\u6709\u5355\u4E2A\u65B9\u6CD5\u53EF\u4EE5\u5C06\u5B83\u4EEC\u4E32\u8054\u8D77\u6765\uFF0C\u6240\u4EE5\u8FD9\u91CC\u9700\u8981\u4E00\u4E9B\u4EE3\u7801\u6765\u5B9E\u73B0\uFF1A</p><ol><li>\u6211\u4EEC\u521B\u5EFA <code>chunksAll = new Uint8Array(receivedLength)</code> \u2014\u2014 \u4E00\u4E2A\u5177\u6709\u6240\u6709\u6570\u636E\u5757\u5408\u5E76\u540E\u7684\u957F\u5EA6\u7684\u540C\u7C7B\u578B\u6570\u7EC4\u3002</li><li>\u7136\u540E\u4F7F\u7528 <code>.set(chunk, position)</code> \u65B9\u6CD5\uFF0C\u4ECE\u6570\u7EC4\u4E2D\u4E00\u4E2A\u4E2A\u5730\u590D\u5236\u8FD9\u4E9B <code>chunk</code>\u3002</li></ol></li><li><p>\u6211\u4EEC\u7684\u7ED3\u679C\u73B0\u5728\u50A8\u5B58\u5728 <code>chunksAll</code> \u4E2D\u3002\u4F46\u5B83\u662F\u4E00\u4E2A\u5B57\u8282\u6570\u7EC4\uFF0C\u4E0D\u662F\u5B57\u7B26\u4E32\u3002</p><p>\u8981\u521B\u5EFA\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF0C\u6211\u4EEC\u9700\u8981\u89E3\u6790\u8FD9\u4E9B\u5B57\u8282\u3002\u53EF\u4EE5\u4F7F\u7528\u5185\u5EFA\u7684 TextDecoder \u5BF9\u8C61\u5B8C\u6210\u3002\u7136\u540E\uFF0C\u6211\u4EEC\u53EF\u4EE5 <code>JSON.parse</code> \u5B83\uFF0C\u5982\u679C\u6709\u5FC5\u8981\u7684\u8BDD\u3002</p><p>\u5982\u679C\u6211\u4EEC\u9700\u8981\u7684\u662F\u4E8C\u8FDB\u5236\u5185\u5BB9\u800C\u4E0D\u662F\u5B57\u7B26\u4E32\u5462\uFF1F\u8FD9\u66F4\u7B80\u5355\u3002\u7528\u4E0B\u9762\u8FD9\u884C\u4EE3\u7801\u66FF\u6362\u6389\u7B2C 4 \u548C\u7B2C 5 \u6B65\uFF0C\u8FD9\u884C\u4EE3\u7801\u4ECE\u6240\u6709\u5757\u521B\u5EFA\u4E00\u4E2A <code>Blob</code>\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> blob </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Blob</span><span style="color:#A6ACCD;">(chunks)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div></li></ol><p>\u6700\u540E\uFF0C\u6211\u4EEC\u5F97\u5230\u4E86\u7ED3\u679C\uFF08\u4EE5\u5B57\u7B26\u4E32\u6216 blob \u7684\u5F62\u5F0F\u8868\u793A\uFF0C\u4EC0\u4E48\u65B9\u4FBF\u5C31\u7528\u4EC0\u4E48\uFF09\uFF0C\u5E76\u5728\u8FC7\u7A0B\u4E2D\u5BF9\u8FDB\u5EA6\u8FDB\u884C\u4E86\u8DDF\u8E2A\u3002</p><p>\u518D\u5F3A\u8C03\u4E00\u904D\uFF0C\u8FD9\u4E0D\u80FD\u7528\u4E8E <strong>\u4E0A\u4F20</strong> \u8FC7\u7A0B\uFF08\u73B0\u5728\u65E0\u6CD5\u901A\u8FC7 <code>fetch</code> \u83B7\u53D6\uFF09\uFF0C\u4EC5\u7528\u4E8E <strong>\u4E0B\u8F7D</strong> \u8FC7\u7A0B\u3002</p><h2 id="\u4E2D\u6B62-abort" tabindex="-1">\u4E2D\u6B62\uFF08Abort\uFF09 <a class="header-anchor" href="#\u4E2D\u6B62-abort" aria-hidden="true">#</a></h2><p>\u521B\u5EFA\u4E00\u4E2A\u63A7\u5236\u5668\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> controller </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AbortController</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u63A7\u5236\u5668\u662F\u4E00\u4E2A\u6781\u5176\u7B80\u5355\u7684\u5BF9\u8C61\u3002</p><ul><li>\u5B83\u5177\u6709\u5355\u4E2A\u65B9\u6CD5 <code>abort()</code></li><li>\u548C\u5355\u4E2A\u5C5E\u6027 <code>signal</code>\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728\u8FD9\u4E2A\u5C5E\u6027\u4E0A\u8BBE\u7F6E\u4E8B\u4EF6\u76D1\u542C\u5668</li></ul><p>\u5F53 <code>abort()</code> \u88AB\u8C03\u7528\u65F6\uFF1A</p><ul><li><code>controller.signal</code> \u5C31\u4F1A\u89E6\u53D1 <code>abort</code> \u4E8B\u4EF6</li><li><code>controller.signal.aborted</code> \u5C5E\u6027\u53D8\u4E3A <code>true</code></li></ul><p>\u901A\u5E38\uFF0C\u5904\u7406\u5206\u4E3A\u4E24\u90E8\u5206\uFF1A</p><ol><li>\u4E00\u90E8\u5206\u662F\u4E00\u4E2A\u53EF\u53D6\u6D88\u7684\u64CD\u4F5C\uFF0C\u5B83\u5728 <code>controller.signal</code> \u4E0A\u8BBE\u7F6E\u4E00\u4E2A\u76D1\u542C\u5668</li><li>\u53E6\u4E00\u90E8\u5206\u662F\u53D6\u6D88\uFF1A\u5728\u9700\u8981\u7684\u65F6\u5019\u8C03\u7528 <code>controller.abort()</code></li></ol><p>\u901A\u8FC7<code>controller.abort()</code>\u4E2D\u6B62fetch\uFF0C\u5F53\u4E00\u4E2A fetch \u88AB\u4E2D\u6B62\uFF0C\u5B83\u7684 promise \u5C31\u4F1A\u4EE5\u4E00\u4E2A error <code>AbortError</code> reject\uFF0C\u56E0\u6B64\u6211\u4EEC\u5E94\u8BE5\u5BF9\u5176\u8FDB\u884C\u5904\u7406\uFF0C\u4F8B\u5982\u5728 <code>try..catch</code> \u4E2D\u3002</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// 1 \u79D2\u540E\u4E2D\u6B62</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> controller </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AbortController</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> controller</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/article/fetch-abort/demo/hang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    signal</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">controller</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">signal</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;">(err) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">AbortError</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// handle abort()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Aborted!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>AbortController</code> \u662F\u53EF\u4F38\u7F29\u7684\uFF0C\u5B83\u5141\u8BB8\u4E00\u6B21\u53D6\u6D88\u591A\u4E2A fetch\u3002</p><p>\u5982\u679C\u6211\u4EEC\u6709\u81EA\u5DF1\u7684\u4E0E <code>fetch</code> \u4E0D\u540C\u7684\u5F02\u6B65\u4EFB\u52A1\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u5355\u4E2A <code>AbortController</code> \u4E2D\u6B62\u8FD9\u4E9B\u4EFB\u52A1\u4EE5\u53CA fetch\u3002</p><p>\u5728\u6211\u4EEC\u7684\u4EFB\u52A1\u4E2D\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u76D1\u542C\u5176 <code>abort</code> \u4E8B\u4EF6\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> urls </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> controller </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AbortController</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> ourJob </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u6211\u4EEC\u7684\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">controller</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">signal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">abort</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> fetchJobs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> urls</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// fetches</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">signal</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> controller</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">signal</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u7B49\u5F85\u5B8C\u6210\u6211\u4EEC\u7684\u4EFB\u52A1\u548C\u6240\u6709 fetch</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> results </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">fetchJobs</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ourJob])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5982\u679C controller.abort() \u88AB\u4ECE\u5176\u4ED6\u5730\u65B9\u8C03\u7528\uFF0C</span></span>
<span class="line"><span style="color:#676E95;">// \u5B83\u5C06\u4E2D\u6B62\u6240\u6709 fetch \u548C ourJob</span></span>
<span class="line"></span></code></pre></div><h2 id="\u8DE8\u6E90\u8BF7\u6C42" tabindex="-1">\u8DE8\u6E90\u8BF7\u6C42 <a class="header-anchor" href="#\u8DE8\u6E90\u8BF7\u6C42" aria-hidden="true">#</a></h2><p>\u8FD9\u91CC\u7684\u6838\u5FC3\u6982\u5FF5\u662F <strong>\u6E90\uFF08origin\uFF09</strong>\u2014\u2014 \u57DF\uFF08domain\uFF09/\u7AEF\u53E3\uFF08port\uFF09/\u534F\u8BAE\uFF08protocol\uFF09\u7684\u7EC4\u5408\u3002</p><p>\u8DE8\u6E90\u8BF7\u6C42 \u2014\u2014 \u90A3\u4E9B\u53D1\u9001\u5230\u5176\u4ED6\u57DF\uFF08\u5373\u4F7F\u662F\u5B50\u57DF\uFF09\u3001\u534F\u8BAE\u6216\u7AEF\u53E3\u7684\u8BF7\u6C42 \u2014\u2014 \u9700\u8981\u6765\u81EA\u8FDC\u7A0B\u7AEF\u7684\u7279\u6B8A header\u3002</p><p>\u8FD9\u4E2A\u7B56\u7565\u88AB\u79F0\u4E3A \u201CCORS\u201D\uFF1A\u8DE8\u6E90\u8D44\u6E90\u5171\u4EAB\uFF08Cross-Origin Resource Sharing\uFF09\u3002</p><h3 id="\u7B80\u5355\u7684\u8BF7\u6C42" tabindex="-1">\u7B80\u5355\u7684\u8BF7\u6C42 <a class="header-anchor" href="#\u7B80\u5355\u7684\u8BF7\u6C42" aria-hidden="true">#</a></h3><p>\u4E00\u4E2A\u7B80\u5355\u7684\u8BF7\u6C42\u662F\u6307\u6EE1\u8DB3\u4EE5\u4E0B\u4E24\u4E2A\u6761\u4EF6\u7684\u8BF7\u6C42\uFF1A</p><ol><li>\u7B80\u5355\u7684\u65B9\u6CD5\uFF1AGET\uFF0CPOST \u6216 HEAD</li><li>\u7B80\u5355\u7684 header\u2014\u2014 \u4EC5\u5141\u8BB8\u81EA\u5B9A\u4E49\u4E0B\u5217 header\uFF1A <ul><li><code>Accept</code>\uFF0C</li><li><code>Accept-Language</code>\uFF0C</li><li><code>Content-Language</code>\uFF0C</li><li><code>Content-Type</code> \u7684\u503C\u4E3A <code>application/x-www-form-urlencoded</code>\uFF0C<code>multipart/form-data</code> \u6216 <code>text/plain</code>\u3002</li></ul></li></ol><p><strong>\u672C\u8D28\u533A\u522B\u5728\u4E8E\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>&lt;form&gt;</code> \u6216 <code>&lt;script&gt;</code> \u8FDB\u884C\u201C\u7B80\u5355\u8BF7\u6C42\u201D\uFF0C\u800C\u65E0\u9700\u4EFB\u4F55\u5176\u4ED6\u7279\u6B8A\u65B9\u6CD5\u3002</strong></p><h4 id="\u7B80\u5355\u8BF7\u6C42\u7684cors" tabindex="-1">\u7B80\u5355\u8BF7\u6C42\u7684CORS <a class="header-anchor" href="#\u7B80\u5355\u8BF7\u6C42\u7684cors" aria-hidden="true">#</a></h4><p>\u5982\u679C\u4E00\u4E2A\u8BF7\u6C42\u662F\u8DE8\u6E90\u7684\uFF0C\u6D4F\u89C8\u5668\u59CB\u7EC8\u4F1A\u5411\u5176\u6DFB\u52A0 <code>Origin</code> header\u3002</p><p>\u670D\u52A1\u5668\u53EF\u4EE5\u68C0\u67E5 <code>Origin</code>\uFF0C\u5982\u679C\u540C\u610F\u63A5\u53D7\u8FD9\u6837\u7684\u8BF7\u6C42\uFF0C\u5C31\u4F1A\u5728\u54CD\u5E94\u4E2D\u6DFB\u52A0\u4E00\u4E2A\u7279\u6B8A\u7684 header <code>Access-Control-Allow-Origin</code>\u3002\u8BE5 header \u5305\u542B\u4E86\u5141\u8BB8\u7684\u6E90\u3002\u7136\u540E\u54CD\u5E94\u6210\u529F\uFF0C\u5426\u5219\u62A5\u9519\u3002</p><p><img src="`+o+`" alt=""></p><h4 id="response-header" tabindex="-1">Response Header <a class="header-anchor" href="#response-header" aria-hidden="true">#</a></h4><p>\u5BF9\u4E8E\u8DE8\u6E90\u8BF7\u6C42\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CJavaScript \u53EA\u80FD\u8BBF\u95EE\u201C\u7B80\u5355\u201D response header\uFF1A</p><ul><li><code>Cache-Control</code></li><li><code>Content-Language</code></li><li><code>Content-Type</code></li><li><code>Expires</code></li><li><code>Last-Modified</code></li><li><code>Pragma</code></li></ul><p>\u8BBF\u95EE\u4EFB\u4F55\u5176\u4ED6 response header \u90FD\u5C06\u5BFC\u81F4 error\u3002</p><p>\u8981\u6388\u4E88 JavaScript \u5BF9\u4EFB\u4F55\u5176\u4ED6 response header \u7684\u8BBF\u95EE\u6743\u9650\uFF0C\u670D\u52A1\u5668\u5FC5\u987B\u53D1\u9001 <code>Access-Control-Expose-Headers</code> header\u3002\u5B83\u5305\u542B\u4E00\u4E2A\u4EE5\u9017\u53F7\u5206\u9694\u7684\u5E94\u8BE5\u88AB\u8BBE\u7F6E\u4E3A\u53EF\u8BBF\u95EE\u7684\u975E\u7B80\u5355 header \u540D\u79F0\u5217\u8868\u3002</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">200 OK</span></span>
<span class="line"><span style="color:#A6ACCD;">Content-Type:text/html</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> charset=UTF-8</span></span>
<span class="line"><span style="color:#A6ACCD;">Content-Length: 12345</span></span>
<span class="line"><span style="color:#A6ACCD;">API-Key: 2c9de507f2c54aa1</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Allow-Origin: https://javascript.info</span></span>
<span class="line"><span style="color:#676E95;">## \u6709\u4E86\u8FD9\u79CD Access-Control-Expose-Headers header\uFF0C\u6B64\u811A\u672C\u5C31\u88AB\u5141\u8BB8\u8BFB\u53D6\u54CD\u5E94\u7684 Content-Length \u548C API-Key header\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Expose-Headers: Content-Length,API-Key</span></span>
<span class="line"></span></code></pre></div><h3 id="\u975E\u7B80\u5355-\u8BF7\u6C42" tabindex="-1">&quot;\u975E\u7B80\u5355&quot;\u8BF7\u6C42 <a class="header-anchor" href="#\u975E\u7B80\u5355-\u8BF7\u6C42" aria-hidden="true">#</a></h3><p>\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u4EFB\u4F55 HTTP \u65B9\u6CD5\uFF1A\u4E0D\u4EC5\u4EC5\u662F <code>GET/POST</code>\uFF0C\u4E5F\u53EF\u4EE5\u662F <code>PATCH</code>\uFF0C<code>DELETE</code> \u53CA\u5176\u4ED6\u3002</p><p>\u9884\u68C0\u8BF7\u6C42\u4F7F\u7528 <code>OPTIONS</code> \u65B9\u6CD5\uFF0C\u5B83\u6CA1\u6709 body\uFF0C\u4F46\u662F\u6709\u4E24\u4E2A header\uFF1A</p><ul><li><code>Access-Control-Request-Method</code> header \u5E26\u6709\u975E\u7B80\u5355\u8BF7\u6C42\u7684\u65B9\u6CD5\u3002</li><li><code>Access-Control-Request-Headers</code> header \u63D0\u4F9B\u4E00\u4E2A\u4EE5\u9017\u53F7\u5206\u9694\u7684\u975E\u7B80\u5355 HTTP-header \u5217\u8868\u3002</li></ul><p>\u5982\u679C\u670D\u52A1\u5668\u540C\u610F\u5904\u7406\u8BF7\u6C42\uFF0C\u90A3\u4E48\u5B83\u4F1A\u8FDB\u884C\u54CD\u5E94\uFF0C\u6B64\u54CD\u5E94\u7684\u72B6\u6001\u7801\u5E94\u8BE5\u4E3A 200\uFF0C\u6CA1\u6709 body\uFF0C\u5177\u6709 header\uFF1A</p><ul><li><code>Access-Control-Allow-Origin</code> \u5FC5\u987B\u4E3A <code>*</code> \u6216\u8FDB\u884C\u8BF7\u6C42\u7684\u6E90\uFF08\u4F8B\u5982 <code>https://javascript.info</code>\uFF09\u624D\u80FD\u5141\u8BB8\u6B64\u8BF7\u6C42\u3002</li><li><code>Access-Control-Allow-Methods</code> \u5FC5\u987B\u5177\u6709\u5141\u8BB8\u7684\u65B9\u6CD5\u3002</li><li><code>Access-Control-Allow-Headers</code> \u5FC5\u987B\u5177\u6709\u4E00\u4E2A\u5141\u8BB8\u7684 header \u5217\u8868\u3002</li><li>\u53E6\u5916\uFF0Cheader <code>Access-Control-Max-Age</code> \u53EF\u4EE5\u6307\u5B9A\u7F13\u5B58\u6B64\u6743\u9650\u7684\u79D2\u6570\u3002\u56E0\u6B64\uFF0C\u6D4F\u89C8\u5668\u4E0D\u662F\u5FC5\u987B\u4E3A\u6EE1\u8DB3\u7ED9\u5B9A\u6743\u9650\u7684\u540E\u7EED\u8BF7\u6C42\u53D1\u9001\u9884\u68C0\u3002</li></ul><p><img src="`+p+`" alt="QQ\u622A\u56FE20210802212735"></p><p>\u5BF9\u4E8E\u4E00\u4E2A\u8DE8\u6E90\u8BF7\u6C42\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://site.com/service.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PATCH</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">API-Key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">secret</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>Step 1 \u9884\u68C0\u8BF7\u6C42\uFF08preflight request\uFF09</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">## \u8BF7\u6C42\u65B9\u6CD5  \u8BF7\u6C42\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#A6ACCD;">OPTIONS /service.json</span></span>
<span class="line"><span style="color:#A6ACCD;">Host: site.com</span></span>
<span class="line"><span style="color:#676E95;">## \u7279\u6B8A\u8DE8\u6E90\u5934</span></span>
<span class="line"><span style="color:#A6ACCD;">Origin: https://javascript.info							</span><span style="color:#676E95;">## \u6765\u6E90</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Request-Method: PATCH					</span><span style="color:#676E95;">## \u8BF7\u6C42\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Request-Headers: Content-Type,API-Key	</span><span style="color:#676E95;">## \u4EE5\u9017\u53F7\u5206\u9694\u7684\u201C\u975E\u7B80\u5355\u201D header \u5217\u8868</span></span>
<span class="line"></span></code></pre></div><p>Step 2 \u9884\u68C0\u54CD\u5E94\uFF08preflight response\uFF09</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">200 OK</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Allow-Origin: https://javascript.info</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Allow-Methods: PUT,PATCH,DELETE</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Allow-Headers: API-Key,Content-Type,If-Modified-Since,Cache-Control</span></span>
<span class="line"><span style="color:#676E95;">## \u7ED9\u5B9A\u65F6\u95F4\u5185\u9884\u68C0\u6743\u9650\u4F1A\u88AB\u7F13\u5B58</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Max-Age: 86400</span></span>
<span class="line"></span></code></pre></div><p>Step 3 \u5B9E\u9645\u8BF7\u6C42\uFF08actual request\uFF09</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">PATCH /service.json</span></span>
<span class="line"><span style="color:#A6ACCD;">Host: site.com</span></span>
<span class="line"><span style="color:#A6ACCD;">Content-Type: application/json</span></span>
<span class="line"><span style="color:#A6ACCD;">API-Key: secret</span></span>
<span class="line"><span style="color:#A6ACCD;">Origin: https://javascript.info</span></span>
<span class="line"></span></code></pre></div><p>Step 4 \u5B9E\u9645\u54CD\u5E94\uFF08actual response\uFF09</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">Access-Control-Allow-Origin: https://javascript.info</span></span>
<span class="line"></span></code></pre></div><h3 id="\u51ED\u636E" tabindex="-1">\u51ED\u636E <a class="header-anchor" href="#\u51ED\u636E" aria-hidden="true">#</a></h3><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u7531 JavaScript \u4EE3\u7801\u53D1\u8D77\u7684\u8DE8\u6E90\u8BF7\u6C42\u4E0D\u4F1A\u5E26\u6765\u4EFB\u4F55\u51ED\u636E\uFF08cookies \u6216\u8005 HTTP \u8BA4\u8BC1\uFF08HTTP authentication\uFF09\uFF09\u3002</p><p>\u8981\u5728 <code>fetch</code> \u4E2D\u53D1\u9001\u51ED\u636E\uFF0C\u6211\u4EEC\u9700\u8981\u6DFB\u52A0 <code>credentials: &quot;include&quot;</code> \u9009\u9879\uFF0C\u50CF\u8FD9\u6837\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// fetch\u5C06\u628A\u6E90\u81EAanother.com\u7684cookie\u548C\u6211\u4EEC\u7684\u8BF7\u6C42\u53D1\u9001\u5230\u8BE5\u7F51\u7AD9\u3002</span></span>
<span class="line"><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://another.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">credentials</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">include</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u670D\u52A1\u5668\u540C\u610F\u63A5\u53D7 <strong>\u5E26\u6709\u51ED\u636E</strong> \u7684\u8BF7\u6C42\uFF0C\u5219\u9664\u4E86 <code>Access-Control-Allow-Origin</code> \u5916\uFF0C\u670D\u52A1\u5668\u8FD8\u5E94\u8BE5\u5728\u54CD\u5E94\u4E2D\u6DFB\u52A0 header <code>Access-Control-Allow-Credentials: true</code>\u3002</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">200 OK</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Allow-Origin: https://javascript.info</span></span>
<span class="line"><span style="color:#A6ACCD;">Access-Control-Allow-Credentials: </span><span style="color:#82AAFF;">true</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5BF9\u4E8E\u5177\u6709\u51ED\u636E\u7684\u8BF7\u6C42\uFF0C\u7981\u6B62 <code>Access-Control-Allow-Origin</code> \u4F7F\u7528\u661F\u53F7 <code>*</code>\u3002\u5982\u4E0A\u6240\u793A\uFF0C\u5B83\u5FC5\u987B\u6709\u4E00\u4E2A\u786E\u5207\u7684\u6E90\u3002\u8FD9\u662F\u53E6\u4E00\u9879\u5B89\u5168\u63AA\u65BD\u3002</p></blockquote><h2 id="fetch-api" tabindex="-1">fetch API <a class="header-anchor" href="#fetch-api" aria-hidden="true">#</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> promise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// POST\uFF0CPUT\uFF0CDELETE\uFF0C\u7B49\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5185\u5BB9\u7C7B\u578B header \u503C\u901A\u5E38\u662F\u81EA\u52A8\u8BBE\u7F6E\u7684</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u53D6\u51B3\u4E8E request body</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Content-Type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/plain;charset=UTF-8</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// string\uFF0CFormData\uFF0CBlob\uFF0CBufferSource\uFF0C\u6216 URLSearchParams</span></span>
<span class="line"><span style="color:#A6ACCD;">  referrer: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">about:client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u6216 &quot;&quot; \u4EE5\u4E0D\u53D1\u9001 Referer header\uFF0C</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6216\u8005\u662F\u5F53\u524D\u6E90\u7684 url</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">referrerPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">no-referrer-when-downgrade</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// no-referrer\uFF0Corigin\uFF0Csame-origin...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cors</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// same-origin\uFF0Cno-cors</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">credentials</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">same-origin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// omit\uFF0Cinclude</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">cache</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// no-store\uFF0Creload\uFF0Cno-cache\uFF0Cforce-cache\uFF0C\u6216 only-if-cached</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">redirect</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">follow</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// manual\uFF0Cerror</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">integrity</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u4E00\u4E2A hash\uFF0C\u50CF &quot;sha256-abcdef1234567890&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">keepalive</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">signal</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// AbortController \u6765\u4E2D\u6B62\u8BF7\u6C42</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">window</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> window </span><span style="color:#676E95;">// null</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><ul><li><code>referer</code> \uFF1A\u6307\u793A\u4E00\u4E2A\u8BF7\u6C42\u662F\u4ECE\u54EA\u91CC\u94FE\u63A5\u8FC7\u6765 <ul><li>\u6BD4\u5982\u6211\u5728<code>www.google.com</code>\u91CC\u6709\u4E00\u4E2A<code>www.baidu.com</code> \u94FE\u63A5\uFF0C\u90A3\u4E48\u70B9\u51FB\u8FD9\u4E2A<code>www.baidu.com</code> \uFF0C\u5B83\u7684<code>header</code> \u4FE1\u606F\u91CC\u5C31\u6709\uFF1A<code>Referer=http://www.google.com</code></li></ul></li></ul><blockquote><p>\u7531\u4E8E\u65E9\u671F\u62FC\u5199\u9519\u8BEF\uFF0Creferer\u5B57\u6BB5\u5C06\u9519\u5C31\u9519\uFF0C\u6B63\u786E\u7684\u82F1\u8BED\u62FC\u6CD5\u662Freferrer</p></blockquote><ul><li><code>referrerPolicy</code>\uFF1A<code>Referer</code> \u8BBE\u7F6E\u4E00\u822C\u7684\u89C4\u5219</li></ul><table><thead><tr><th style="text-align:left;">\u503C</th><th style="text-align:left;">\u540C\u6E90</th><th style="text-align:left;">\u8DE8\u6E90</th><th style="text-align:left;">HTTPS\u2192HTTP</th></tr></thead><tbody><tr><td style="text-align:left;"><code>&quot;no-referrer&quot;</code></td><td style="text-align:left;">-</td><td style="text-align:left;">-</td><td style="text-align:left;">-</td></tr><tr><td style="text-align:left;"><code>&quot;no-referrer-when-downgrade&quot;</code> \u6216 <code>&quot;&quot;</code>\uFF08\u9ED8\u8BA4\uFF09</td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td><td style="text-align:left;">-</td></tr><tr><td style="text-align:left;"><code>&quot;origin&quot;</code></td><td style="text-align:left;">\u4EC5\u57DF</td><td style="text-align:left;">\u4EC5\u57DF</td><td style="text-align:left;">\u4EC5\u57DF</td></tr><tr><td style="text-align:left;"><code>&quot;origin-when-cross-origin&quot;</code></td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td><td style="text-align:left;">\u4EC5\u57DF</td><td style="text-align:left;">\u4EC5\u57DF</td></tr><tr><td style="text-align:left;"><code>&quot;same-origin&quot;</code></td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td><td style="text-align:left;">-</td><td style="text-align:left;">-</td></tr><tr><td style="text-align:left;"><code>&quot;strict-origin&quot;</code></td><td style="text-align:left;">\u4EC5\u57DF</td><td style="text-align:left;">\u4EC5\u57DF</td><td style="text-align:left;">-</td></tr><tr><td style="text-align:left;"><code>&quot;strict-origin-when-cross-origin&quot;</code></td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td><td style="text-align:left;">\u4EC5\u57DF</td><td style="text-align:left;">-</td></tr><tr><td style="text-align:left;"><code>&quot;unsafe-url&quot;</code></td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td><td style="text-align:left;">\u5B8C\u6574\u7684 url</td></tr></tbody></table><ul><li><code>mode</code>\uFF1A\u63A7\u5236\u8DE8\u6E90\u8BF7\u6C42 <ul><li><code>cors</code>\uFF1A\u9ED8\u8BA4\u503C\uFF0C\u8FD0\u884C\u8DE8\u6E90\u8BF7\u6C42</li><li><code>same-origin</code>\uFF1A\u7981\u6B62\u8DE8\u6E90\u8BF7\u6C42</li><li><code>no-cors</code>\uFF1A\u53EA\u8FD0\u884C\u7B80\u5355\u8DE8\u6E90\u8BF7\u6C42</li></ul></li><li><code>credentials</code>\uFF1A\u6307\u5B9A <code>fetch</code> \u662F\u5426\u5E94\u8BE5\u968F\u8BF7\u6C42\u53D1\u9001 cookie \u548C HTTP-Authorization header <ul><li><code>same-origin</code>\uFF1A\u9ED8\u8BA4\u503C\uFF0C\u5BF9\u4E8E\u8DE8\u6E90\u8BF7\u6C42\u4E0D\u53D1\u9001</li><li><code>include</code>\uFF1A\u603B\u662F\u53D1\u9001\uFF0C\u9700\u8981\u6765\u81EA\u8DE8\u6E90\u670D\u52A1\u5668\u7684 <code>Accept-Control-Allow-Credentials</code>\uFF0C\u624D\u80FD\u4F7F JavaScript \u80FD\u591F\u8BBF\u95EE\u54CD\u5E94</li><li><code>omit</code>\uFF1A\u4E0D\u53D1\u9001\uFF0C\u5373\u4F7F\u5BF9\u540C\u6E90\u8BF7\u6C42</li></ul></li><li><code>cache</code><ul><li><code>default</code>\uFF1A\u4F7F\u7528\u6807\u51C6\u7684HTTP\u7F13\u5B58\u89C4\u5219\u548Cheader</li><li><code>no-store</code>\uFF1A\u5B8C\u5168\u5FFD\u7565HTTP\u7F13\u5B58</li><li><code>reload</code>\uFF1A\u4E0D\u4ECEHTTP\u7F13\u5B58\u4E2D\u83B7\u53D6\u7ED3\u679C\uFF0C\u800C\u662F\u4F7F\u7528\u54CD\u5E94\u586B\u5145\u7F13\u5B58</li><li><code>no-cache</code>\uFF1A\u5982\u679C\u6709\u4E00\u4E2A\u5DF2\u7F13\u5B58\u7684\u54CD\u5E94\uFF0C\u5219\u521B\u5EFA\u4E00\u4E2A\u6709\u6761\u4EF6\u7684\u8BF7\u6C42\uFF0C\u5426\u5219\u521B\u5EFA\u4E00\u4E2A\u666E\u901A\u8BF7\u6C42\u3002\u4F7F\u7528\u54CD\u5E94\u586B\u5145HTTP\u7F13\u5B58</li><li><code>force-cache</code>\uFF1A\u4F7F\u7528\u6765\u81EAHTTP\u7F13\u5B58\u7684\u54CD\u5E94\uFF0C\u5373\u4F7F\u8BE5\u54CD\u5E94\u5DF2\u679C\u5B9E\u3002\u5982\u679C HTTP \u7F13\u5B58\u4E2D\u6CA1\u6709\u54CD\u5E94\uFF0C\u5219\u521B\u5EFA\u4E00\u4E2A\u5E38\u89C4\u7684 HTTP \u8BF7\u6C42\uFF0C\u884C\u4E3A\u50CF\u6B63\u5E38\u90A3\u6837\u3002</li><li><code>only-if-cached</code>\uFF1A\u4F7F\u7528\u6765\u81EA HTTP \u7F13\u5B58\u7684\u54CD\u5E94\uFF0C\u5373\u4F7F\u8BE5\u54CD\u5E94\u5DF2\u8FC7\u65F6\u3002\u5982\u679C HTTP \u7F13\u5B58\u4E2D\u6CA1\u6709\u54CD\u5E94\uFF0C\u5219\u62A5\u9519\u3002\u53EA\u6709\u5F53 <code>mode</code> \u4E3A <code>same-origin</code> \u65F6\u751F\u6548\u3002</li></ul></li><li><code>redirect</code>\uFF1A\u91CD\u5B9A\u5411 <ul><li><code>follow</code>\uFF1A\u9ED8\u8BA4\u503C\uFF0C\u9075\u5FAAHTTP\u91CD\u5B9A\u5411</li><li><code>error</code>\uFF1AHTTP\u91CD\u5B9A\u5411\u65F6\u62A5\u9519</li><li><code>manual</code>\uFF1A\u4E0D\u9075\u5FAAHTTP\u91CD\u5B9A\u5411\uFF0C\u4F46 <code>response.url</code> \u5C06\u662F\u4E00\u4E2A\u65B0\u7684 URL\uFF0C\u5E76\u4E14 <code>response redirectd</code> \u5C06\u4E3A <code>true</code>\uFF0C\u4EE5\u4FBF\u6211\u4EEC\u80FD\u591F\u624B\u52A8\u6267\u884C\u91CD\u5B9A\u5411\u5230\u65B0\u7684 URL</li></ul></li><li><code>integrity</code>\uFF1A\u5141\u8BB8\u68C0\u67E5\u54CD\u5E94\u662F\u5426\u4E0E\u5DF2\u77E5\u7684\u9884\u5148\u6821\u9A8C\u548C\u76F8\u5339\u914D</li><li><code>keepalive</code>\uFF1A\u8868\u793A\u8BE5\u8BF7\u6C42\u53EF\u80FD\u4F1A\u4F7F\u53D1\u8D77\u5B83\u7684\u7F51\u9875\u201C\u5931\u6D3B\uFF08outlive\uFF09\u201D</li></ul><h2 id="url\u5BF9\u8C61" tabindex="-1">URL\u5BF9\u8C61 <a class="header-anchor" href="#url\u5BF9\u8C61" aria-hidden="true">#</a></h2><p><code>new URL(url, [base])</code>\uFF1A</p><ul><li><code>url</code>\u2014\u2014 \u5B8C\u6574\u7684 URL\uFF0C\u6216\u8005\u4EC5\u8DEF\u5F84\uFF08\u5982\u679C\u8BBE\u7F6E\u4E86 base\uFF09\uFF0C</li><li><code>base</code>\u2014\u2014 \u53EF\u9009\u7684 base URL\uFF1A\u5982\u679C\u8BBE\u7F6E\u4E86\u6B64\u53C2\u6570\uFF0C\u4E14\u53C2\u6570 <code>url</code> \u53EA\u6709\u8DEF\u5F84\uFF0C\u5219\u4F1A\u6839\u636E\u8FD9\u4E2A <code>base</code> \u751F\u6210 URL\u3002</li></ul><p><img src="`+e+`" alt=""></p><p>url.searchParams\uFF1A</p><ul><li><code>append(name, value)</code>\u2014\u2014 \u6309\u7167 <code>name</code> \u6DFB\u52A0\u53C2\u6570\uFF0C</li><li><code>delete(name)</code>\u2014\u2014 \u6309\u7167 <code>name</code> \u79FB\u9664\u53C2\u6570\uFF0C</li><li><code>get(name)</code> \u2014\u2014 \u6309\u7167 <code>name</code> \u83B7\u53D6\u53C2\u6570\uFF0C</li><li><code>getAll(name)</code>\u2014\u2014 \u83B7\u53D6\u76F8\u540C <code>name</code> \u7684\u6240\u6709\u53C2\u6570\uFF08\u8FD9\u662F\u53EF\u884C\u7684\uFF0C\u4F8B\u5982 <code>?user=John&amp;user=Pete</code>\uFF09\uFF0C</li><li><code>has(name)</code> \u2014\u2014 \u6309\u7167 <code>name</code> \u68C0\u67E5\u53C2\u6570\u662F\u5426\u5B58\u5728\uFF0C</li><li><code>set(name, value)</code>\u2014\u2014 set/replace \u53C2\u6570\uFF0C</li><li><code>sort()</code> \u2014\u2014 \u6309 name \u5BF9\u53C2\u6570\u8FDB\u884C\u6392\u5E8F\uFF0C\u5F88\u5C11\u4F7F\u7528\uFF0C</li><li>\u2026\u2026\u5E76\u4E14\u5B83\u662F\u53EF\u8FED\u4EE3\u7684\uFF0C\u7C7B\u4F3C\u4E8E <code>Map</code>\u3002</li></ul><p>\u7F16\u7801\u548C\u89E3\u7801\uFF1A</p><ul><li><code>encodeURI</code>\u2014\u2014 \u7F16\u7801\u6574\u4E2A URL</li><li><code>decodeURI</code>\u2014\u2014 \u89E3\u7801\u4E3A\u7F16\u7801\u524D\u7684\u72B6\u6001</li><li><code>encodeURIComponent</code> \u2014\u2014 \u7F16\u7801 URL \u7EC4\u4EF6\uFF0C\u4F8B\u5982\u641C\u7D22\u53C2\u6570\uFF0C\u6216\u8005 hash\uFF0C\u6216\u8005 pathname</li><li><code>decodeURIComponent</code>\u2014\u2014 \u89E3\u7801\u4E3A\u7F16\u7801\u524D\u7684\u72B6\u6001</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// \u5728 url \u8DEF\u5F84\u4E2D\u4F7F\u7528\u897F\u91CC\u5C14\u5B57\u7B26</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">encodeURI</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://site.com/\u043F\u0440\u0438\u0432\u0435\u0442</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(url)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// http://site.com/%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> music </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">encodeURIComponent</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Rock&amp;Roll</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">https://google.com/search?q=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">music</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(url)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// https://google.com/search?q=Rock%26Roll</span></span>
<span class="line"></span></code></pre></div><h2 id="xmlhttprequest" tabindex="-1">XMLHttpRequest <a class="header-anchor" href="#xmlhttprequest" aria-hidden="true">#</a></h2><h3 id="\u57FA\u672C\u4F7F\u7528" tabindex="-1">\u57FA\u672C\u4F7F\u7528 <a class="header-anchor" href="#\u57FA\u672C\u4F7F\u7528" aria-hidden="true">#</a></h3><p>XMLHttpRequest \u6709\u4E24\u79CD\u6267\u884C\u6A21\u5F0F\uFF1A\u540C\u6B65\uFF08synchronous\uFF09\u548C\u5F02\u6B65\uFF08asynchronous\uFF09</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// 1.\u521B\u5EFA\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> xhr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// 2.\u521D\u59CB\u5316</span></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(method</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> URL</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [async</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> user</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> password])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// 3.\u53D1\u9001\u8BF7\u6C42</span></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">([body];</span></span>
<span class="line"><span style="color:#676E95;">/* 4.\u76D1\u542Cxhr\u4E8B\u4EF6\u4EE5\u83B7\u53D6\u54CD\u5E94\u3002</span></span>
<span class="line"><span style="color:#676E95;">load \u2014\u2014 \u5F53\u8BF7\u6C42\u5B8C\u6210\uFF08\u5373\u4F7F HTTP \u72B6\u6001\u4E3A 400 \u6216 500 \u7B49\uFF09\uFF0C\u5E76\u4E14\u54CD\u5E94\u5DF2\u5B8C\u5168\u4E0B\u8F7D\u3002</span></span>
<span class="line"><span style="color:#676E95;">error \u2014\u2014 \u5F53\u65E0\u6CD5\u53D1\u51FA\u8BF7\u6C42\uFF0C\u4F8B\u5982\u7F51\u7EDC\u4E2D\u65AD\u6216\u8005\u65E0\u6548\u7684 URL\u3002</span></span>
<span class="line"><span style="color:#676E95;">progress \u2014\u2014 \u5728\u4E0B\u8F7D\u54CD\u5E94\u671F\u95F4\u5B9A\u671F\u89E6\u53D1\uFF0C\u62A5\u544A\u5DF2\u7ECF\u4E0B\u8F7D\u4E86\u591A\u5C11\u3002</span></span>
<span class="line"><span style="color:#676E95;">*/</span></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Loaded: </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onerror</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u4EC5\u5728\u6839\u672C\u65E0\u6CD5\u53D1\u51FA\u8BF7\u6C42\u65F6\u89E6\u53D1</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Network Error</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onprogress</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u5B9A\u671F\u89E6\u53D1</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// event.loaded \u2014\u2014 \u5DF2\u7ECF\u4E0B\u8F7D\u4E86\u591A\u5C11\u5B57\u8282</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// event.lengthComputable = true\uFF0C\u5F53\u670D\u52A1\u5668\u53D1\u9001\u4E86 Content-Length header \u65F6</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// event.total \u2014\u2014 \u603B\u5B57\u8282\u6570\uFF08\u5982\u679C lengthComputable \u4E3A true\uFF09</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Received </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">loaded</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> of </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">total</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>\u8BBE\u7F6E\u54CD\u5E94\u7C7B\u578B\uFF1A<code>xhr.responseType</code>\uFF0C\u53EF\u4EE5\u4E3A<code>\u7A7A\u3001text\u3001arraybuffer\u3001blob\u3001document\u3001json</code>\u8FD9\u51E0\u79CD\u3002</p><p>readyState\uFF1A\u53EF\u4EE5\u901A\u8FC7<code>xhr.readyState</code>\u4E86\u89E3\u5F53\u524D\u72B6\u6001</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">UNSENT = 0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> // \u521D\u59CB\u72B6\u6001</span></span>
<span class="line"><span style="color:#A6ACCD;">OPENED = 1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> // open \u88AB\u8C03\u7528</span></span>
<span class="line"><span style="color:#A6ACCD;">HEADERS_RECEIVED = 2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> // \u63A5\u6536\u5230 response header</span></span>
<span class="line"><span style="color:#A6ACCD;">LOADING = 3</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> // \u54CD\u5E94\u6B63\u5728\u88AB\u52A0\u8F7D\uFF08\u63A5\u6536\u5230\u4E00\u4E2A\u6570\u636E\u5305\uFF09</span></span>
<span class="line"><span style="color:#A6ACCD;">DONE = 4</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> // \u8BF7\u6C42\u5B8C\u6210</span></span>
<span class="line"></span></code></pre></div><p>\u4E2D\u6B62\u8BF7\u6C42\uFF1A<code>xhr.abort()</code>\uFF0C\u4F1A\u89E6\u53D1abort\u4E8B\u4EF6\uFF0C\u4E14<code>xhr.status</code>\u53D8\u62100</p><p>HTTP-header\uFF1A</p><ul><li><code>setRequestHeader(name, value)</code></li><li><code>getResponseHeader(name)</code></li><li><code>getAllResponseHeaders()</code></li></ul><h3 id="post\u8BF7\u6C42-1" tabindex="-1">POST\u8BF7\u6C42 <a class="header-anchor" href="#post\u8BF7\u6C42-1" aria-hidden="true">#</a></h3><p>\u4EE5 <code>multipart/form-data</code> \u7F16\u7801\u53D1\u9001\u8868\u5355\uFF1A</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">person</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">value</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">surname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">value</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Smith</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4ECE\u8868\u5355\u9884\u586B\u5145 FormData</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> formData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FormData</span><span style="color:#A6ACCD;">(document</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">forms</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">person)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u9644\u52A0\u4E00\u4E2A\u5B57\u6BB5</span></span>
<span class="line"><span style="color:#A6ACCD;">  formData</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">middle</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Lee</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5C06\u5176\u53D1\u9001\u51FA\u53BB</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> xhr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/article/xmlhttprequest/post/user</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">(formData)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">response)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u53D1\u9001JSON\u5B57\u7B26\u4E32\uFF1A</p><blockquote><p>\u6CE8\u610F\uFF1A\u4E0D\u8981\u5FD8\u8BB0\u8BBE\u7F6E header <code>Content-Type: application/json</code>\uFF0C\u53EA\u8981\u6709\u4E86\u5B83\uFF0C\u5F88\u591A\u670D\u52A1\u7AEF\u6846\u67B6\u90FD\u80FD\u81EA\u52A8\u89E3\u7801 JSON</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> xhr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> json </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">John</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">surname</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Smith</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/submit</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setRequestHeader</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json; charset=utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">(json)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="\u4E0A\u4F20\u8FDB\u5EA6" tabindex="-1">\u4E0A\u4F20\u8FDB\u5EA6 <a class="header-anchor" href="#\u4E0A\u4F20\u8FDB\u5EA6" aria-hidden="true">#</a></h3><p><code>xhr.upload</code>\uFF1A\u8DDF\u8E2A\u4E0A\u4F20\u4E8B\u4EF6</p><ul><li><code>loadstart</code> \u2014\u2014 \u4E0A\u4F20\u5F00\u59CB\u3002</li><li><code>progress</code> \u2014\u2014 \u4E0A\u4F20\u671F\u95F4\u5B9A\u671F\u89E6\u53D1\u3002</li><li><code>abort</code> \u2014\u2014 \u4E0A\u4F20\u4E2D\u6B62\u3002</li><li><code>error</code> \u2014\u2014 \u975E HTTP \u9519\u8BEF\u3002</li><li><code>load</code> \u2014\u2014 \u4E0A\u4F20\u6210\u529F\u5B8C\u6210\u3002</li><li><code>timeout</code> \u2014\u2014 \u4E0A\u4F20\u8D85\u65F6\uFF08\u5982\u679C\u8BBE\u7F6E\u4E86 <code>timeout</code> \u5C5E\u6027\uFF09\u3002</li><li><code>loadend</code> \u2014\u2014 \u4E0A\u4F20\u5B8C\u6210\uFF0C\u65E0\u8BBA\u6210\u529F\u8FD8\u662F error\u3002</li></ul><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onchange</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;">upload</span><span style="color:#C3E88D;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">files</span><span style="color:#C3E88D;">[</span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">])</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">upload</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">file</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">xhr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8DDF\u8E2A\u4E0A\u4F20\u8FDB\u5EA6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">upload</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onprogress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Uploaded </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">loaded</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> of </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">total</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8DDF\u8E2A\u5B8C\u6210\uFF1A\u65E0\u8BBA\u6210\u529F\u4E0E\u5426</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onloadend</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">success</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/article/xmlhttprequest/post/upload</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">file</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><h3 id="\u8DE8\u6E90\u8BF7\u6C42-1" tabindex="-1">\u8DE8\u6E90\u8BF7\u6C42 <a class="header-anchor" href="#\u8DE8\u6E90\u8BF7\u6C42-1" aria-hidden="true">#</a></h3><p><code>XMLHttpRequest</code> \u53EF\u4EE5\u4F7F\u7528\u548Cfetch\u76F8\u540C\u7684 CORS \u7B56\u7565\u8FDB\u884C\u8DE8\u6E90\u8BF7\u6C42\u3002</p><p>\u5C31\u50CF <code>fetch</code> \u4E00\u6837\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4E0D\u4F1A\u5C06 cookie \u548C HTTP \u6388\u6743\u53D1\u9001\u5230\u5176\u4ED6\u57DF\u3002\u8981\u542F\u7528\u5B83\u4EEC\uFF0C\u53EF\u4EE5\u5C06 <code>xhr.withCredentials</code> \u8BBE\u7F6E\u4E3A <code>true</code>\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> xhr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">withCredentials </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">xhr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://anywhere.com/request</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="\u957F\u8F6E\u8BE2" tabindex="-1">\u957F\u8F6E\u8BE2 <a class="header-anchor" href="#\u957F\u8F6E\u8BE2" aria-hidden="true">#</a></h2><p>\u5176\u6D41\u7A0B\u4E3A\uFF1A</p><ol><li>\u8BF7\u6C42\u53D1\u9001\u5230\u670D\u52A1\u5668\u3002</li><li>\u670D\u52A1\u5668\u5728\u6709\u6D88\u606F\u4E4B\u524D\u4E0D\u4F1A\u5173\u95ED\u8FDE\u63A5\u3002</li><li>\u5F53\u6D88\u606F\u51FA\u73B0\u65F6 \u2014\u2014 \u670D\u52A1\u5668\u5C06\u5BF9\u5176\u8BF7\u6C42\u4F5C\u51FA\u54CD\u5E94\u3002</li><li>\u6D4F\u89C8\u5668\u7ACB\u5373\u53D1\u51FA\u4E00\u4E2A\u65B0\u7684\u8BF7\u6C42\u3002</li></ol><p><img src="`+t+`" alt=""></p><p>\u5982\u679C\u8FDE\u63A5\u4E22\u5931\uFF0C\u53EF\u80FD\u662F\u56E0\u4E3A\u7F51\u7EDC\u9519\u8BEF\uFF0C\u6D4F\u89C8\u5668\u4F1A\u7ACB\u5373\u53D1\u9001\u4E00\u4E2A\u65B0\u8BF7\u6C42\u3002</p><p>\u5B9E\u73B0\u957F\u8F6E\u8BE2\u7684\u5BA2\u6237\u7AEF <code>subscribe</code> \u51FD\u6570\u7684\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">subscribe</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/subscribe</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">502</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u72B6\u6001 502 \u662F\u8FDE\u63A5\u8D85\u65F6\u9519\u8BEF\uFF0C</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u8FDE\u63A5\u6302\u8D77\u65F6\u95F4\u8FC7\u957F\u65F6\u53EF\u80FD\u4F1A\u53D1\u751F\uFF0C</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u8FDC\u7A0B\u670D\u52A1\u5668\u6216\u4EE3\u7406\u4F1A\u5173\u95ED\u5B83</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u8BA9\u6211\u4EEC\u91CD\u65B0\u8FDE\u63A5</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">subscribe</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4E00\u4E2A error \u2014\u2014 \u8BA9\u6211\u4EEC\u663E\u793A\u5B83</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">showMessage</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusText</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u4E00\u79D2\u540E\u91CD\u65B0\u8FDE\u63A5</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">subscribe</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u83B7\u53D6\u5E76\u663E\u793A\u6D88\u606F</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">text</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">showMessage</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u518D\u6B21\u8C03\u7528 subscribe() \u4EE5\u83B7\u53D6\u4E0B\u4E00\u6761\u6D88\u606F</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">subscribe</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">subscribe</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6B63\u5982\u4F60\u6240\u770B\u5230\u7684\uFF0C<code>subscribe</code> \u51FD\u6570\u53D1\u8D77\u4E86\u4E00\u4E2A <code>fetch</code>\uFF0C\u7136\u540E\u7B49\u5F85\u54CD\u5E94\uFF0C\u5904\u7406\u5B83\uFF0C\u5E76\u518D\u6B21\u8C03\u7528\u81EA\u8EAB\u3002</p>`,145),D=[r];function F(y,A,C,i,d,u){return n(),a("div",null,D)}const E=s(c,[["render",F]]);export{g as __pageData,E as default};
